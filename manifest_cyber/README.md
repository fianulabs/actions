# Capture Manifest Cyber Evidence Using the Fianu CLI

This GitHub Action captures evidence generated by the manifest cyber GitHub Action using the Fianu CLI.

## Inputs

| Name                         | Description                                                                                                                     | Required | Default                                                                                             |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------|----------|-----------------------------------------------------------------------------------------------------|
| `fianu-host`                 | Fianu host.                                                                                                                     | true     |                                                                                                     |
| `fianu-client-id`            | Fianu client ID.                                                                                                                | true     |                                                                                                     |
| `fianu-client-secret`        | Fianu client secret.                                                                                                            | true     |                                                                                                     |
| `manifest-cyber-sbom-output` | The path to the SBOM outputted by the manifest cyber action.                                                                    | true     |                                                                                                     |
| `bom-ref-path`               | Reference to the BOM ref in the JSON output. Defaults to the path for CycloneDX. For SPDX the path is `.name`.                  | false    | `.metadata.component["bom-ref"]`                                                                    |
| `manifest-cyber-host`        | Manifest Cyber host.                                                                                                            | false    | `https://api.manifestcyber.com`                                                                     |
| `fianu-app-code`             | Fianu App Code                                                                                                                  | true     |                                                                                                     |
| `fianu-username`             | Fianu Username (optional)                                                                                                       | false    |                                                                                                     |
| `fianu-asset-token`          | Fianu Asset Token associated with the Fianu Asset to which evidence should be associated.                                       | false    |                                                                                                     |
| `fianu-service-account`      | Service account identifier for generating credentials and performing keyless signing. Mutually exclusive with `identity-token`. | false    |                                                                                                     |
| `fianu-debug`                | Enable verbose Fianu CLI output.                                                                                                | false    | `false`                                                                                             |
| `identity-token`             | Identity token for keyless signing. Required if `fianu-service-account` is not specified.                                       | false    |                                                                                                     |
| `workload-identity-provider` | Workload identity provider for generating an identity token to authenticate with Fianu.                                         | false    | `projects/68661080711/locations/global/workloadIdentityPools/fianu-github-actions/providers/github` |
| `audience`                   | Identity token audience for generating an identity token to authenticate with Fianu.                                            | false    | `sigstore`                                                                                          |

## Usage

```yaml
name: Capture Manifest Cyber Evidence

on: [ push ]

jobs:
  capture-evidence:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Capture Evidence
        uses: fianulabs/actions/manifest_cyber@main
        with:
          fianu-host: ${{ secrets.FIANU_HOST }}
          fianu-client-id: ${{ secrets.FIANU_CLIENT_ID }}
          fianu-client-secret: ${{ secrets.FIANU_CLIENT_SECRET }}
          manifest-cyber-sbom-output: path/to/sbom/output
          fianu-app-code: ${{ secrets.FIANU_APP_CODE }}
          fianu-username: ${{ secrets.FIANU_USERNAME }}
          fianu-asset-token: ${{ secrets.FIANU_ASSET_TOKEN }}
          fianu-service-account: ${{ secrets.FIANU_SERVICE_ACCOUNT }}
          fianu-debug: 'false'
          audience: sigstore
```

## Steps Details

1. **Extract SBOM Reference**:
   Extracts the SBOM reference from the Manifest Cyber SBOM output using the jq-action.

2. **Prepare Fianu Options**:
   Prepares the necessary Fianu CLI options and sets the SBOM format based on the bom-ref-path input.

3. **Capture Blob Evidence**:
   Uses the Fianu CLI to capture the blob evidence from the SBOM output.
